{"ast":null,"code":"import FuseUtils from '@fuse/utils';\nimport AppContext from 'app/AppContext';\nimport { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { matchRoutes } from 'react-router-config';\nimport { withRouter } from 'react-router-dom';\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass FuseAuthorization extends Component {\n  constructor(props, context) {\n    super(props);\n    const {\n      routes\n    } = context;\n    this.state = {\n      accessGranted: true,\n      routes\n    };\n  }\n\n  componentDidMount() {\n    if (!this.state.accessGranted) {\n      this.redirectRoute();\n    }\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return nextState.accessGranted !== this.state.accessGranted;\n  }\n\n  componentDidUpdate() {\n    if (!this.state.accessGranted) {\n      this.redirectRoute();\n    }\n  }\n\n  static getDerivedStateFromProps(props, state) {\n    const {\n      location,\n      userRole\n    } = props;\n    const {\n      pathname\n    } = location;\n    const matched = matchRoutes(state.routes, pathname)[0];\n    return {\n      accessGranted: matched ? FuseUtils.hasPermission(matched.route.auth, userRole) : true\n    };\n  }\n\n  redirectRoute() {\n    const {\n      location,\n      userRole,\n      history\n    } = this.props;\n    const {\n      pathname,\n      state\n    } = location;\n    const redirectUrl = state && state.redirectUrl ? state.redirectUrl : '/';\n    /*\n          User is guest\n          Redirect to Login Page\n          */\n\n    if (!userRole || userRole.length === 0) {\n      history.push({\n        pathname: '/login',\n        state: {\n          redirectUrl: pathname\n        }\n      });\n    } else {\n      /*\n           User is member\n           User must be on unAuthorized page or just logged in\n           Redirect to dashboard or redirectUrl\n           */\n      history.push({\n        pathname: redirectUrl\n      });\n    }\n  }\n\n  render() {\n    // console.info('Fuse Authorization rendered', this.state.accessGranted);\n    return this.state.accessGranted ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: this.props.children\n    }, void 0, false) : null;\n  }\n\n}\n\nfunction mapStateToProps({\n  auth\n}) {\n  return {\n    userRole: auth.user.role\n  };\n}\n\nFuseAuthorization.contextType = AppContext;\nexport default withRouter(connect(mapStateToProps)(FuseAuthorization));","map":{"version":3,"sources":["/Users/mozcan/Desktop/UK/gasbroker-front-end/src/@fuse/core/FuseAuthorization/FuseAuthorization.js"],"names":["FuseUtils","AppContext","Component","connect","matchRoutes","withRouter","FuseAuthorization","constructor","props","context","routes","state","accessGranted","componentDidMount","redirectRoute","shouldComponentUpdate","nextProps","nextState","componentDidUpdate","getDerivedStateFromProps","location","userRole","pathname","matched","hasPermission","route","auth","history","redirectUrl","length","push","render","children","mapStateToProps","user","role","contextType"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,aAAtB;AACA,OAAOC,UAAP,MAAuB,gBAAvB;AACA,SAASC,SAAT,QAA0B,OAA1B;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,WAAT,QAA4B,qBAA5B;AACA,SAASC,UAAT,QAA2B,kBAA3B;;;;AAEA,MAAMC,iBAAN,SAAgCJ,SAAhC,CAA0C;AACzCK,EAAAA,WAAW,CAACC,KAAD,EAAQC,OAAR,EAAiB;AAC3B,UAAMD,KAAN;AACA,UAAM;AAAEE,MAAAA;AAAF,QAAaD,OAAnB;AACA,SAAKE,KAAL,GAAa;AACZC,MAAAA,aAAa,EAAE,IADH;AAEZF,MAAAA;AAFY,KAAb;AAIA;;AAEDG,EAAAA,iBAAiB,GAAG;AACnB,QAAI,CAAC,KAAKF,KAAL,CAAWC,aAAhB,EAA+B;AAC9B,WAAKE,aAAL;AACA;AACD;;AAEDC,EAAAA,qBAAqB,CAACC,SAAD,EAAYC,SAAZ,EAAuB;AAC3C,WAAOA,SAAS,CAACL,aAAV,KAA4B,KAAKD,KAAL,CAAWC,aAA9C;AACA;;AAEDM,EAAAA,kBAAkB,GAAG;AACpB,QAAI,CAAC,KAAKP,KAAL,CAAWC,aAAhB,EAA+B;AAC9B,WAAKE,aAAL;AACA;AACD;;AAE8B,SAAxBK,wBAAwB,CAACX,KAAD,EAAQG,KAAR,EAAe;AAC7C,UAAM;AAAES,MAAAA,QAAF;AAAYC,MAAAA;AAAZ,QAAyBb,KAA/B;AACA,UAAM;AAAEc,MAAAA;AAAF,QAAeF,QAArB;AAEA,UAAMG,OAAO,GAAGnB,WAAW,CAACO,KAAK,CAACD,MAAP,EAAeY,QAAf,CAAX,CAAoC,CAApC,CAAhB;AAEA,WAAO;AACNV,MAAAA,aAAa,EAAEW,OAAO,GAAGvB,SAAS,CAACwB,aAAV,CAAwBD,OAAO,CAACE,KAAR,CAAcC,IAAtC,EAA4CL,QAA5C,CAAH,GAA2D;AAD3E,KAAP;AAGA;;AAEDP,EAAAA,aAAa,GAAG;AACf,UAAM;AAAEM,MAAAA,QAAF;AAAYC,MAAAA,QAAZ;AAAsBM,MAAAA;AAAtB,QAAkC,KAAKnB,KAA7C;AACA,UAAM;AAAEc,MAAAA,QAAF;AAAYX,MAAAA;AAAZ,QAAsBS,QAA5B;AACA,UAAMQ,WAAW,GAAGjB,KAAK,IAAIA,KAAK,CAACiB,WAAf,GAA6BjB,KAAK,CAACiB,WAAnC,GAAiD,GAArE;AAEA;AACF;AACA;AACA;;AACE,QAAI,CAACP,QAAD,IAAaA,QAAQ,CAACQ,MAAT,KAAoB,CAArC,EAAwC;AACvCF,MAAAA,OAAO,CAACG,IAAR,CAAa;AACZR,QAAAA,QAAQ,EAAE,QADE;AAEZX,QAAAA,KAAK,EAAE;AAAEiB,UAAAA,WAAW,EAAEN;AAAf;AAFK,OAAb;AAIA,KALD,MAKO;AACN;AACH;AACA;AACA;AACA;AACGK,MAAAA,OAAO,CAACG,IAAR,CAAa;AACZR,QAAAA,QAAQ,EAAEM;AADE,OAAb;AAGA;AACD;;AAEDG,EAAAA,MAAM,GAAG;AACR;AACA,WAAO,KAAKpB,KAAL,CAAWC,aAAX,gBAA2B;AAAA,gBAAG,KAAKJ,KAAL,CAAWwB;AAAd,qBAA3B,GAAwD,IAA/D;AACA;;AAlEwC;;AAqE1C,SAASC,eAAT,CAAyB;AAAEP,EAAAA;AAAF,CAAzB,EAAmC;AAClC,SAAO;AACNL,IAAAA,QAAQ,EAAEK,IAAI,CAACQ,IAAL,CAAUC;AADd,GAAP;AAGA;;AAED7B,iBAAiB,CAAC8B,WAAlB,GAAgCnC,UAAhC;AAEA,eAAeI,UAAU,CAACF,OAAO,CAAC8B,eAAD,CAAP,CAAyB3B,iBAAzB,CAAD,CAAzB","sourcesContent":["import FuseUtils from '@fuse/utils';\nimport AppContext from 'app/AppContext';\nimport { Component } from 'react';\nimport { connect } from 'react-redux';\nimport { matchRoutes } from 'react-router-config';\nimport { withRouter } from 'react-router-dom';\n\nclass FuseAuthorization extends Component {\n\tconstructor(props, context) {\n\t\tsuper(props);\n\t\tconst { routes } = context;\n\t\tthis.state = {\n\t\t\taccessGranted: true,\n\t\t\troutes\n\t\t};\n\t}\n\n\tcomponentDidMount() {\n\t\tif (!this.state.accessGranted) {\n\t\t\tthis.redirectRoute();\n\t\t}\n\t}\n\n\tshouldComponentUpdate(nextProps, nextState) {\n\t\treturn nextState.accessGranted !== this.state.accessGranted;\n\t}\n\n\tcomponentDidUpdate() {\n\t\tif (!this.state.accessGranted) {\n\t\t\tthis.redirectRoute();\n\t\t}\n\t}\n\n\tstatic getDerivedStateFromProps(props, state) {\n\t\tconst { location, userRole } = props;\n\t\tconst { pathname } = location;\n\n\t\tconst matched = matchRoutes(state.routes, pathname)[0];\n\n\t\treturn {\n\t\t\taccessGranted: matched ? FuseUtils.hasPermission(matched.route.auth, userRole) : true\n\t\t};\n\t}\n\n\tredirectRoute() {\n\t\tconst { location, userRole, history } = this.props;\n\t\tconst { pathname, state } = location;\n\t\tconst redirectUrl = state && state.redirectUrl ? state.redirectUrl : '/';\n\n\t\t/*\n        User is guest\n        Redirect to Login Page\n        */\n\t\tif (!userRole || userRole.length === 0) {\n\t\t\thistory.push({\n\t\t\t\tpathname: '/login',\n\t\t\t\tstate: { redirectUrl: pathname }\n\t\t\t});\n\t\t} else {\n\t\t\t/*\n        User is member\n        User must be on unAuthorized page or just logged in\n        Redirect to dashboard or redirectUrl\n        */\n\t\t\thistory.push({\n\t\t\t\tpathname: redirectUrl\n\t\t\t});\n\t\t}\n\t}\n\n\trender() {\n\t\t// console.info('Fuse Authorization rendered', this.state.accessGranted);\n\t\treturn this.state.accessGranted ? <>{this.props.children}</> : null;\n\t}\n}\n\nfunction mapStateToProps({ auth }) {\n\treturn {\n\t\tuserRole: auth.user.role\n\t};\n}\n\nFuseAuthorization.contextType = AppContext;\n\nexport default withRouter(connect(mapStateToProps)(FuseAuthorization));\n"]},"metadata":{},"sourceType":"module"}